{
  "id": "NIST FHIR(r) Toolkit (Asbestos) Assertion References Mapping File",
  "referenceMetadata": {
    "version": "1.0",
    "lastUpdated": "2022-JAN-18",
    "comments": {
      "purpose": "This JSON is general purpose format, it may be suitable for other specifications. All specifications are captured as of the lastUpdated date. This offline list only serves as a quick reference for the Asbestos Toolkit users. Users should be familiar with the actual specification guidelines. With the help of the community, any future changes in the actual specification text will have to reported through a GitHub Pull Request for a review until advancements in automated StructureDefinition-based references can generate this format. Note: There is no JSON schema for this ReferenceMetata, it can be added in future.",
      "assertionReferences-assertionId": "Use ShortCode(_Integer)+, where ShortCode is the prefix before the assertion TestScript file. Ids are sequentially numbered, at least one _Integer suffix is required. New independent assertion Ids can be inserted in between two existing Ids by appending a _Integer, example SC_1, SC_1_1, SC_2."
    }
  },
  "assertionReferences": {
    "RM4_1":      [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"}],
    "RM4_1_1":    [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"}],
    "RM4_1_2":    [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"},
                   {"fhir": "httpTransaction", "verbatimPhraseToFocus": "transaction"}],
    "RM4_2":      [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"}],
    "RM4_3":      [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"}],
    "RM4_4":      [{"mhdv4": "ITI-65_BundleResources", "context":"Bundle.meta.profile", "verbatimPhraseToFocus": "Bundle.meta.profile"}],
    "RM4_5":      [{"mhdv4": "SubmissionSetTypeList", "context": "attributeMap" },
                   {"mhdv4": "SubmissionSetTypeList", "context":"mappingToXds" }],
    "RM4_6":      [{"mhdv4": "ITI-65_MessageSemantics", "context": "elements"},
                   {"mhdv4": "DocumentReference", "context": "Min_mappingToXds"}],
    "BR_1":       [{"fhir": "Bundle", "context": ".entry.fullUrl-type"},
                   {"fhir": "resourceUrl-transaction", "verbatimPhraseToFocus": "Note"}],
    "BR_2":       [{"fhir": "Bundle", "context":"bundleConstraint-bdl7"},
                   {"fhir": "transactionProcessingRules-uniqueResource"}],
    "BR_3":       [{"fhir": "httpTransaction"},
                    {"fhir": "Bundle", "context":".entry.request.url"},
                    {"fhir": "Bundle", "context":".entry.request.method-cardinality"}
                   ],
    "BR_4":       [{"fhir": "Bundle", "context":".entry.request.url", "verbatimPhraseToFocus": "Type"}],
    "DR_1":       [{"mhd": "DocumentReference", "context": ".content"  }],
    "DR_2":       [{"mhd": "DocumentReference", "context": ".content.attachment.url"}],
    "DR_3":       [{"mhd": "DocumentReference", "context": ".content.attachment.contentType"}],
    "DR_4":       [{"mhd": "DocumentReference", "context": ".content.attachment.data"}],
    "DR_5":       [{"mhdv4": "ITI-65_BundleResources", "context": "binaryResourceInBundle"}],
    "DR_6":       [{"mhd": "DocumentReference", "context": ".content.attachment.contentType"}, {"fhir": "Binary", "context": ".contentType"}],
    "DR_7":       [{"mhd": "ITI-65_non-unContainedOption", "context": "sourcePatientInfo"}],
    "DR_8":       [{"mhd": "ITI-65_non-unContainedOption", "context": "MISSINGTEXTInMHD4"}],
    "DR_9":       [{"mhd": "ITI-65_non-unContainedOption", "context": "MISSINGTEXTInMHD4"}],
    "DR_10":      [{"mhd": "DocumentReference", "context": ".masterIdentifier"}],
    "DR_11":      [{"mhd": "DocumentReference", "context": ".status"}],
    "SSLIST_1":   [{"mhdv4": "ITI-65_MessageSemantics", "context": "requestMessage"}],
    "SSLIST_2":   [{"mhdv4": "ITI-65_MessageSemantics", "context": "elements"},
                    {"mhdv4": "SubmissionSetTypeList", "context": ".extension:sourceId"}],
    "SSLIST_3":   [{"mhdv4": "ITI-65_MessageSemantics", "context": "elements"},
                    {"mhdv4": "SubmissionSetTypeList", "context": ".date"}],


    "FTK4RM700":  [{"mhdv4": "patientReference"}],
    "FTKCM105":   [{"mhdv4": "comprehensiveMetadata_subject"}]
  },

  "references": {
    "mhd": {
      "DocumentReference": {
        "baseLink": "https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.DocumentReference-definitions.html#DocumentReference",
        "common": {
          "Source": {
            "text": "IHE ITI"
          },
          "Profile": {
            "text": "MHDv3.x, MHDv4",
            "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
          }
        },
        "context": {
          ".content": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1",
              "comments": "<a target='_blank' href='https://github.com/IHE/ITI.MHD/issues/110'>Issue 110.</a>"
            }]
          },
          ".content.attachment.url": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1"
            }]
          },
          ".content.attachment.contentType": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1"
            }]
          },
          ".content.attachment.data": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 0..0"
            }]
          },
          ".masterIdentifier": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1"
            }]
          },
          "Min_mappingToXds": {
            "MinimalDocumentReference": {
              "text": "Mappings for XDS and MHD Mapping (XDS)",
              "link": "https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.DocumentReference-mappings.html#mappings-for-xds-and-mhd-mapping-xds"
            },
            "SpecificationText": [{
              "text": "identifier DocumentEntry.entryUUID"
            }]
          },
          ".status": {
            "Element": {
            },
            "SpecificationText": [{
              "text": "Control 1..1<br>Type code<br>The codes SHALL be taken from DocumentReferenceStatus The status of the document reference."
            }]
          }
        }
      }
    },
    "mhdv3x": {
    },
    "mhdv4": {
      "ITI-65_BundleResources": {
        "common": {
          "Source": {
            "text": "IHE ITI"
          },
          "Profile": {
            "text": "MHDv4",
            "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
          },
          "Transaction": {
            "text": "ITI-65 Provide Document Bundle",
            "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#2-3-65-provide-document-bundle-iti-65"
          },
          "Volume:Section": {
            "text": "2:3.65.4.1.2.1 Bundle Resources",
            "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#23654121-bundle-resources"
          }
        },
        "context": {
          "Bundle.meta.profile": {
            "SpecificationText": [{
              "text": "The FHIR Bundle.meta.profile shall have the following value depending on the Actor implementation of no options (Minimal Metadata), Comprehensive Metadata Option, or UnContained References Option...",
              "comments": "1:33.2.3 UnContained Reference Option<br>https://profiles.ihe.net/ITI/MHD/1332_actor_options.html#13323-uncontained-reference-option<br>The UnContained Reference Option is not compatible with the XDS on FHIR Option. A system may be able to support both options, but only one will be able to be used at a given deployment.<br>UnContained References Option is not yet supported in Toolkit."
            }]
          },
          "binaryResourceInBundle" : {
            "SpecificationText": [{
              "text": "When the DocumentReference.content.attachment.url points at a Binary Resource, the Binary Resource shall be in the Bundle."
            }]
          }
        }
      },
      "ITI-65_MessageSemantics": {
        "common": {
          "Source": {
            "text": "IHE ITI"
          },
          "Profile": {
            "text": "MHDv4",
            "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
          },
          "Transaction": {
            "text": "ITI-65 Provide Document Bundle",
            "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#2-3-65-provide-document-bundle-iti-65"
          },
          "Volume:Section": {
            "text": "2:3.65.4.1.2 Message Semantics",
            "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#2365412-message-semantics"
          }
        },
        "context": {
          "requestMessage": {
            "SpecificationText": [{
              "hasAssertionOrderBiasAnnotations": true,
              "text": "The Document Source shall initiate [2.1]a FHIR \"transaction\" using a \"create\" action by [1.0]sending an HTTP POST request method [2.0]composed of a FHIR Bundle Resource [2.2]containing: one SubmissionSet type List Resource; [2.3]one or more DocumentReference Resources; [2.4]zero or more Folder type List Resources; and [2.5]zero or more Binary Resources to the Document Recipient. ",
              "comments": "MHD specification issue:<br>https://profiles.ihe.net/ITI/MHD/ITI-65.html#2365412-message-semantics<br>(Para 1.) Zero or more Binary Resources does not seem right. If one or more DocumentReference is expected, then according to 2:3.65.4.1.2.1 Bundle Resources, Binary shall be in the Bundle, then it also implies a minimum of one Binary resource, not zero.<br>Under 2:3.65.4.1.2.1 Bundle Resources, may create one or more Binary is specified."
            }]
          },
          "elements": {
            "SpecificationText": [{
              "text": "(Para 5.)<br/>The Document Source shall assure all FHIR resource elements are consistent with the Document Sharing metadata requirements as specified for attributes ITI TF-3: Table 4.3.1-3 \"Sending Actor Metadata Attribute Optionality\". The Document Source that supports the Comprehensive Metadata or the XDS on FHIR Options shall assure consistency with column \"XDS DS\"; otherwise, the Document Source shall assure consistency with column \"XDR MS\". The Document Source shall not provide any entryUUID values.",
              "comments": "Other DocumentReference Identifiers values will be ignored by Toolkit. Toolkit will assign symbolic Id(s) in the submission to meet XDS requirements."
            }]
          },
          "attributeMap": {
            "SpecificationText": [{
              "text": "(Para 1.)<br/>Refer to ITI TF-3: 4.5.1 for details on the FHIR Resources and how Document Sharing metadata attributes are mapped.",
              "comments": "Relevant information is found in 3:4.5.2 SubmissionSet Metadata Attributes, not in directly in Section 4.5.1."
            }]
          }
        }
      },
      "ITI-65_non-unContainedOption":{
        "common": {
            "Source": {
              "text": "IHE ITI"
            },
            "Profile": {
              "text": "MHDv4",
              "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
            },
            "Transaction": {
              "text": "ITI-65 Provide Document Bundle",
              "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html"
            }
        },
        "context": {
          "sourcePatientInfo": {
            "Volume:Section": {
              "text": "2:3.65.4.1.2.2 Patient Identity",
              "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#23654122-patient-identity"
            },
            "SpecificationText": [{
              "text": "When the UnContained Reference Option is used, there is no need to populate the sourcePatientInfo element. Otherwise, when sourcePatientInfo is provided, the DocumentReference.context.sourcePatientInfo shall be a reference to a \"contained\" Patient Resource."
            }]
          },
          "MISSINGTEXTInMHD4": {
            "Volume:Section": {
              "text": "1:33.2.3 UnContained Reference Option",
              "link": "https://profiles.ihe.net/ITI/MHD/1332_actor_options.html#13323-uncontained-reference-option"
            },
            "SpecificationText": [{
              "text": "See comments below.",
              "comments": "Specification Missing in MHD 4.x. See Previous MHD PDF Rev. 3.2 – Trial Implementation. Table 4.5.1.1-1: FHIR DocumentReference mapping to DocumentEntry<br>Note 1: Indicates that the data shall be represented as a contained resource, unless the UnContained References Option is used."
            }]
          }
        }
      },
      "SubmissionSetTypeList": {
        "baseLink": "https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.SubmissionSet-definitions.html#List",
        "common": {
          "Source": {
            "text": "IHE ITI"
          },
          "Profile": {
            "text": "MHDv4",
            "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
          }
        },
        "context": {
          ".extension:sourceId": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1"
            }]
          },
          ".date": {
            "Element": {},
            "SpecificationText": [{
              "text": "Control 1..1"
            }]
          },
          "attributeMap": {
            "Volume:Section": {
              "text": "3:4.5.2 SubmissionSet Metadata Attributes",
              "link": "https://profiles.ihe.net/ITI/MHD/32_fhir_maps.html#submissionSet"
            },
            "SpecificationText": [{
              "text": "The documented mapping of the metadata elements associated with a Document Sharing SubmissionSet object attributes."
            }]
          },
          "mappingToXds": {
            "SubmissionSet": {
              "text": "Mappings for XDS and MHD Mapping (XDS)",
              "link": "https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.SubmissionSet-mappings.html#mappings-for-xds-and-mhd-mapping-xds"
            },
            "SpecificationText": [{
              "text": "entry<br>&nbsp;&nbsp;item references to DocumentReference(s) and Folder List(s)",
              "comments": "Folder List(s) not yet supported in Toolkit."
            }]
          }
        }
      },
      "patientReference": {
        "Source": {
          "text": "IHE ITI"
        },
        "Profile": {
          "text": "MHDv4",
          "link": "https://profiles.ihe.net/ITI/MHD/toc.html"
        },
        "Transaction": {
          "text": "ITI-65 Provide Document Bundle",
          "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#2-3-65-provide-document-bundle-iti-65"
        },
        "Volume:Section": {
          "text": "2:3.65.4.1.2.2 Patient Identity",
          "link": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#23654122-patient-identity"
        },
        "SpecificationText": [{
          "text": "All DocumentReference.subject, and List.subject values shall be References to a FHIR Patient Resource that may be obtained through use of PDQm, PIXm, or by some other means. If the Patient Resource is accessible to both the Document Source and Document Recipient via an external reference, it shall be included as an external reference. Otherwise, the Patient Resource shall be included in the Bundle."
        }]
      }
    },
    "fhir": {
      "Binary": {
        "baseLink": "https://hl7.org/fhir/binary-definitions.html#Binary",
        "common": {
          "Source": {
            "text": "HL7 FHIR"
          },
          "Resource": {
            "text": "Binary",
            "link": "http://hl7.org/fhir/binary.html"
          }
        },
        "context": {
          ".contentType": {
            "SpecificationText": [{
              "text": "Cardinality 1..1"
            }]
          }
        }
      },
      "Bundle": {
        "common": {
          "Source": {
            "text": "HL7 FHIR"
          }
        },
        "context": {
          ".entry.fullUrl-type": {
            "Section": {
              "text": "2.36 Resource Bundle - Content, 2.36.3 Resource Content",
              "link": "https://hl7.org/fhir/bundle-definitions.html#Bundle.entry.fullUrl"
            },
            "SpecificationText": [{
              "text": "Type uri",
              "comments": "Note that since FHIR resources do not need to be served through the FHIR API, the fullURL might be a URN or an absolute URL that does not end with the logical id of the resource (Resource.id)."
            }]
          },
          ".entry.request.method-cardinality": {
            "Section": {
              "text": "2.36.7 Resource Bundle - Detailed Descriptions"
            },
            "Element": {
              "text": "Bundle.entry.request.method",
              "link": "https://hl7.org/fhir/bundle-definitions.html#Bundle.entry.request.method"
            },
            "SpecificationText": [{
              "text": "Cardinality 1..1"
            }]
          },
          ".entry.request.url": {
            "Section": {
              "text": "2.36.7 Resource Bundle - Detailed Descriptions, "
            },
            "Element": {
             "text": "Bundle.entry.request.url",
              "link": "https://hl7.org/fhir/bundle-definitions.html#Bundle.entry.request.url"
            },
            "SpecificationText": [{
              "text": "Type uri<br>Cardinality 1..1",
              "comments": "E.g. for a Patient Create, the method would be \"POST\" and the URL would be \"Patient\". For a Patient Update, the method would be PUT and the URL would be \"Patient/[id]\"."
            }]
          },
          "bundleConstraint-bdl7": {
            "Section": {
              "text": "2.36 Resource Bundle - Content, 2.36.3.2 Constraints",
              "link": "http://hl7.org/fhir/bundle.html#invs"
            },
            "SpecificationText": [{
              "text": "FullUrl must be unique in a bundle, or else entries with the same fullUrl must have different meta.versionId (except in history bundles)"
            }]
          }
        }
      },
      "transactionProcessingRules-uniqueResource": {
        "Source": {
          "text": "HL7 FHIR"
        },
         "Section": {
          "text": "RESTful API 3.1.0.11.2 Transaction Processing Rules",
           "link": "https://hl7.org/fhir/http.html#trules"
         },
         "SpecificationText": [{
           "text": "A resource can only appear in a transaction once (by identity). "
         }]
      },
      "httpTransaction": {
        "Source": {
          "text": "HL7 FHIR"
        },
        "Section": {
          "text": "RESTful API 3.1.0.11 batch/transaction",
          "link": "https://hl7.org/fhir/R4/http.html#transaction"
        },
        "SpecificationText": [{
          "text": "(Para 5.)<br>The content of the post submission is a Bundle with Bundle.type = batch or transaction. Each entry SHALL carry request details (Bundle.entry.request) that provides the HTTP details of the action in order to inform the system processing the batch or transaction what to do for the entry. If the HTTP command is a PUT or POST, then the entry SHALL contain a resource for the body of the action. "
        }]
      },
      "resourceUrl-transaction": {
        "Source": {
          "text": "HL7 FHIR"
        },
        "Section": {
          "text": "2.36 Resource Bundle - Content, 2.36.4 Resource URL & Uniqueness rules in a bundle",
          "link": "https://hl7.org/fhir/bundle.html#bundle-unique"
        },
        "SpecificationText": [{
         "text": "For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST, and the resource has no identity. Note that even in this case, there may still be a fullURL in a transaction on a POST so that relationships between resources can be represented",
          "comments": "When processing a \"POST\" (create), the full URL is treated as the id of the resource on the source, and is ignored; the server generates an id for the resource. (https://hl7.org/fhir/http.html#trules)"
        }]
      }
    }
  },
  "oldReferenceRoot_ToBeRemoved": {
    "Profile": "MHD Rev 3.1",
    "MHDPDBRequestIsBundle": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBRequestIsTransaction": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBUsesPost": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBOneDocumentManifest": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBOnePlusDocumentReference": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBMediaType": "ITI-65 - 3.65.4.1.2 Message Semantics Para 1",
    "MHDPDBMetadataType": "ITI-65 - 3.65.4.1.2.1 Bundle Resources Para 2",
    "MHDPDBBinaryInBundle": [
      "ITI-65 - 3.65.4.1.2.1 Bundle Resources Para 4",
      "When the DocumentReference.content.attachment.url points at a Binary Resource, the Binary Resource shall be in the Bundle. See FHIR Resolving references in Bundles at http://hl7.org/fhir/R4/bundle.html#references."
    ],
    "MHDPDBAttachmentContentType": "content.attachment.contentType",
    "MHDPDBPatientReference": "ITI-65 - 3.65.4.1.2.2 Patient Identity Para 1",
    "MHDPDBSourcePatientInfoIsContained": "ITI-65 - 3.65.4.1.2.2 Patient Identity Para 2",
    "MHDPDBGoodStatus": "ITI-65 - 3.65.4.2.2 Message Semantics Para 2",
    "MHDPDBEntryReturns201": "ITI-65 - 3.65.4.2.2 Message Semantics Para 2",
    "MHDPDBReturnLocation": "ITI-65 - 3.65.4.2.2 Message Semantics Para 2",
    "MHDPDBReturnEtag": "ITI-65 - 3.65.4.2.2 Message Semantics Para 2",
    "MHDPDBDocRefHasAttachment": "ITI-65 - Table 4.5.1.1-1 content.attachment.url",
    "MHDPDBFullUrlUniqueInBundle": "http://hl7.org/fhir/bundle.html#invs bld-7",
    "MHDPDBReturnsBundle": "ITI-65 - 3.65.4.2.2 Message Semantics Para 1",
    "FHIRTransReturnsBundle": "http://hl7.org/fhir/http.html#transaction-response",
    "FHIRTransReturns201": "http://hl7.org/fhir/http.html#transaction-response",
    "MHDv4BundleResources": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#23654121-bundle-resources",
    "MHDv4MessageSemantics": "https://profiles.ihe.net/ITI/MHD/ITI-65.html#2365412-message-semantics",
    "MHDSendingActorMetadataAttributeOptionality": "ITI TF-3: Table 4.3.1-3 Sending Actor Metadata Attribute Optionality, https://profiles.ihe.net/ITI/MHD/ITI-65.html#2365412-message-semantics and https://profiles.ihe.net/ITI/TF/Volume3/ch-4.3.html",
    "MHDv4_3:4.5.2SubmissionSetMetadataAttributes": "https://profiles.ihe.net/ITI/MHD/32_fhir_maps.html#submissionSet",
    "comments": [
      " bundle profile comprehensive or minimal 3.65.4.1.2.1 - Bundle Resources The FHIR Bundle.meta.profile shall have the following value depending on the use of"
    ]
  }
}
